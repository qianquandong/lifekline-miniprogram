<!--result.wxml-->
<view class="container" catchtap="stopPropagation">
  <!-- è¿”å›æŒ‰é’® - ç‹¬ç«‹åœ¨å·¦ä¸Šè§’ -->
  <view class="back-btn-wrapper" bindtap="goBack">
    <text class="back-icon">â€¹</text>
    <text class="back-text">è¿”å›</text>
  </view>

  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <text class="header-title">åˆ†ææŠ¥å‘Š</text>
    </view>
  </view>

  <!-- å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
  <scroll-view class="scroll-content" scroll-y enhanced show-scrollbar="{{false}}">

  <!-- å…«å­—ä¿¡æ¯å¡ç‰‡ -->
  <view wx:if="{{bazi}}" class="bazi-card">
    <view class="bazi-card-title">å…«å­—ä¿¡æ¯</view>
    <view class="bazi-pillars">
      <view class="bazi-pillar" data-pillar="year">
        <view class="pillar-label">å¹´</view>
        <view class="pillar-content">
          <text class="pillar-gan">{{bazi.year.gan}}</text>
          <text class="pillar-zhi">{{bazi.year.zhi}}</text>
        </view>
        <view class="pillar-wuxing"></view>
      </view>
      <view class="bazi-pillar" data-pillar="month">
        <view class="pillar-label">æœˆ</view>
        <view class="pillar-content">
          <text class="pillar-gan">{{bazi.month.gan}}</text>
          <text class="pillar-zhi">{{bazi.month.zhi}}</text>
        </view>
        <view class="pillar-wuxing"></view>
      </view>
      <view class="bazi-pillar" data-pillar="day">
        <view class="pillar-label">æ—¥</view>
        <view class="pillar-content">
          <text class="pillar-gan">{{bazi.day.gan}}</text>
          <text class="pillar-zhi">{{bazi.day.zhi}}</text>
        </view>
        <view class="pillar-wuxing"></view>
      </view>
      <view class="bazi-pillar" data-pillar="hour">
        <view class="pillar-label">æ—¶</view>
        <view class="pillar-content">
          <text class="pillar-gan">{{bazi.hour.gan}}</text>
          <text class="pillar-zhi">{{bazi.hour.zhi}}</text>
        </view>
        <view class="pillar-wuxing"></view>
      </view>
    </view>
    <view class="bazi-info">
      <text>{{bazi.input.birthDate}} {{bazi.input.birthTime}} {{bazi.input.gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === 'report' ? 'active' : ''}}" 
      data-tab="report"
      bindtap="switchTab"
    >
      <text>åˆ†ææŠ¥å‘Š</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'chart' ? 'active' : ''}}" 
      data-tab="chart"
      bindtap="switchTab"
    >
      <text>è¿åŠ¿Kçº¿</text>
    </view>
  </view>

  <!-- åˆ†ææŠ¥å‘Š -->
  <view wx:if="{{activeTab === 'report' && analysisData}}" class="report-container">
    <!-- æ€§æ ¼åˆ†æ -->
    <view wx:if="{{analysisData.personality}}" class="report-section">
      <view class="section-header" data-section="personality" bindtap="toggleSection">
        <view class="section-left">
          <text class="section-icon">ğŸ§ </text>
          <text class="section-title">æ€§æ ¼åˆ†æ</text>
        </view>
        <view class="section-right">
          <text class="section-toggle">{{expandedSections.personality ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>
      <view wx:if="{{expandedSections.personality}}" class="section-content">
        <text class="section-text">{{analysisData.personality}}</text>
      </view>
    </view>

    <!-- äº‹ä¸šåˆ†æ -->
    <view wx:if="{{analysisData.career}}" class="report-section">
      <view class="section-header" data-section="career" bindtap="toggleSection">
        <view class="section-left">
          <text class="section-icon">ğŸ’¼</text>
          <text class="section-title">äº‹ä¸šåˆ†æ</text>
        </view>
        <view class="section-right">
          <text class="section-toggle">{{expandedSections.career ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>
      <view wx:if="{{expandedSections.career}}" class="section-content">
        <text class="section-text">{{analysisData.career}}</text>
      </view>
    </view>

    <!-- è´¢å¯Œåˆ†æ -->
    <view wx:if="{{analysisData.wealth}}" class="report-section">
      <view class="section-header" data-section="wealth" bindtap="toggleSection">
        <view class="section-left">
          <text class="section-icon">ğŸ’°</text>
          <text class="section-title">è´¢å¯Œåˆ†æ</text>
        </view>
        <view class="section-right">
          <text class="section-toggle">{{expandedSections.wealth ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>
      <view wx:if="{{expandedSections.wealth}}" class="section-content">
        <text class="section-text">{{analysisData.wealth}}</text>
      </view>
    </view>

    <!-- å©šå§»åˆ†æ -->
    <view wx:if="{{analysisData.marriage}}" class="report-section">
      <view class="section-header" data-section="marriage" bindtap="toggleSection">
        <view class="section-left">
          <text class="section-icon">ğŸ’•</text>
          <text class="section-title">å©šå§»åˆ†æ</text>
        </view>
        <view class="section-right">
          <text class="section-toggle">{{expandedSections.marriage ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>
      <view wx:if="{{expandedSections.marriage}}" class="section-content">
        <text class="section-text">{{analysisData.marriage}}</text>
      </view>
    </view>

    <!-- å¥åº·åˆ†æ -->
    <view wx:if="{{analysisData.health}}" class="report-section">
      <view class="section-header" data-section="health" bindtap="toggleSection">
        <view class="section-left">
          <text class="section-icon">ğŸŒ¿</text>
          <text class="section-title">å¥åº·åˆ†æ</text>
        </view>
        <view class="section-right">
          <text class="section-toggle">{{expandedSections.health ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>
      <view wx:if="{{expandedSections.health}}" class="section-content">
        <text class="section-text">{{analysisData.health}}</text>
      </view>
    </view>
    
    <!-- ç©ºæ•°æ®æç¤º -->
    <view wx:if="{{!analysisData.personality && !analysisData.career && !analysisData.wealth && !analysisData.marriage && !analysisData.health}}" class="empty-tip">
      <text>æš‚æ— åˆ†ææ•°æ®ï¼Œè¯·å…ˆå¯¼å…¥AIåˆ†æç»“æœ</text>
    </view>
  </view>

  <!-- Kçº¿å›¾ -->
  <view wx:if="{{activeTab === 'chart' && analysisData}}" class="chart-container">
    <view class="chart-wrapper">
      <canvas 
        wx:if="{{chartWidth > 0 && chartHeight > 0}}"
        type="2d" 
        id="kline-canvas" 
        class="kline-canvas"
        style="width: {{chartWidth}}px; height: {{chartHeight}}px;"
        bindtap="onCanvasTap"
      ></canvas>
      <view wx:else class="chart-loading">åŠ è½½ä¸­...</view>
      
      <!-- å›¾ä¾‹è¯´æ˜ -->
      <view class="chart-legend">
        <view class="legend-item">
          <view class="legend-color" style="background: #26a69a;"></view>
          <text>ä¸Šæ¶¨</text>
        </view>
        <view class="legend-item">
          <view class="legend-color" style="background: #ef5350;"></view>
          <text>ä¸‹è·Œ</text>
        </view>
        <view class="legend-item">
          <view class="legend-color" style="background: #999;"></view>
          <text>å¹³ç¨³</text>
        </view>
      </view>
      <view class="legend-hint">ç‚¹å‡»å›¾è¡¨æŸ¥çœ‹è¯¦æƒ…</view>
    </view>
  </view>

  <!-- æ•°æ®ç‚¹è¯¦æƒ…å¼¹çª— - ç‹¬ç«‹åœ¨å›¾è¡¨å®¹å™¨å¤– -->
  <view wx:if="{{showPointDetail && selectedPoint}}" class="point-detail-modal" bindtap="closePointDetail">
    <view class="point-detail-content" catchtap="stopPropagation">
      <view class="point-detail-header">
        <text class="point-detail-title">{{selectedPoint.age}}å²è¿åŠ¿</text>
        <text class="point-detail-close" bindtap="closePointDetail">Ã—</text>
      </view>
      <view class="point-detail-body">
        <view class="point-detail-item">
          <text class="point-label">å¹´é¾„ï¼š</text>
          <text class="point-value">{{selectedPoint.age}}å²</text>
        </view>
        <view class="point-detail-item">
          <text class="point-label">è¿åŠ¿åˆ†æ•°ï¼š</text>
          <text class="point-value score-{{selectedPoint.trend}}">{{selectedPoint.score}}åˆ†</text>
        </view>
        <view class="point-detail-item">
          <text class="point-label">è¶‹åŠ¿ï¼š</text>
          <text class="point-value">
            {{selectedPoint.trend === 'up' ? 'ä¸Šå‡' : selectedPoint.trend === 'down' ? 'ä¸‹é™' : 'å¹³ç¨³'}}
          </text>
        </view>
      </view>
    </view>
  </view>
  </scroll-view>
</view>
